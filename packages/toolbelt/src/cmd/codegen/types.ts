/**
 * Copyright (c) The Blossom GraphQL Team.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 */

import VERSION from '../../version';
import { generateTypesFileNodes } from '../../lib/codegen';
import { typesFilePath } from '../../lib/paths';
import { linkTypesFile } from '../../lib/linking';
import { cliRunWrapper } from '../../lib/runtime';
import {
  codegenPipelineMaker,
  makeGraphCodegenPipeline,
} from '../../lib/cmd/codegen/common';

const HEADER_TEXT = `/**
* Autogenerated with Blossom Toolbelt v${VERSION}.
*
* DO NOT MODIFY UNLESS YOU KNOW WHAT YOU ARE DOING.
*/`;

const generateTypesFile = codegenPipelineMaker((filePath, fileGraph) => {
  const linkedTypesFile = linkTypesFile(filePath, fileGraph);

  return generateTypesFileNodes(linkedTypesFile);
}, HEADER_TEXT);

export const generateTypes = makeGraphCodegenPipeline({
  codeGenerator: generateTypesFile,
  pathGenerator: typesFilePath,
});

export default cliRunWrapper(generateTypes);
